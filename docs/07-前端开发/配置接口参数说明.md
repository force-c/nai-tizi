# 配置接口参数说明

## 更新日期
2025/12/31

## 背景
配置管理接口的前后端参数定义已完善，确保类型安全和参数一致性。

## 接口定义

### 1. 创建配置 (POST /api/v1/config)

#### 后端定义
```go
type CreateConfigRequest struct {
    Name     string          `json:"name" binding:"required"`     // 配置名称（必填）
    Type     string          `json:"type" binding:"required"`     // 配置类型（必填）
    Data     json.RawMessage `json:"data"`                        // 配置数据（可选，JSON格式）
    Remark   string          `json:"remark"`                      // 备注（可选）
    CreateBy int64           `json:"createBy" binding:"required"` // 创建者ID（必填）
    UpdateBy int64           `json:"updateBy" binding:"required"` // 更新者ID（必填）
}
```

#### 前端定义
```typescript
interface CreateConfigParams {
  name: string;      // 配置名称（必填）
  type: string;      // 配置类型（必填）
  data?: any;        // 配置数据（可选）
  remark?: string;   // 备注（可选）
  createBy: number;  // 创建者ID（必填）
  updateBy: number;  // 更新者ID（必填）
}
```

#### 请求示例
```typescript
import { configApi } from '@/api/config';
import { useUserStore } from '@/store/user';

const userStore = useUserStore();
const userId = userStore.userInfo?.id;

// 创建配置
await configApi.create({
  name: '系统配置',
  type: 'system_settings',
  data: {
    siteName: '我的网站',
    siteUrl: 'https://example.com'
  },
  remark: '系统基础配置',
  createBy: userId,  // 必须传递当前用户ID
  updateBy: userId   // 必须传递当前用户ID
});
```

### 2. 更新配置 (PUT /api/v1/config)

#### 后端定义
```go
type UpdateConfigRequest struct {
    ID       int64           `json:"id" binding:"required"`       // 配置ID（必填）
    Name     string          `json:"name" binding:"required"`     // 配置名称（必填）
    Type     string          `json:"type" binding:"required"`     // 配置类型（必填）
    Data     json.RawMessage `json:"data"`                        // 配置数据（可选，JSON格式）
    Remark   string          `json:"remark"`                      // 备注（可选）
    UpdateBy int64           `json:"updateBy" binding:"required"` // 更新者ID（必填）
}
```

#### 前端定义
```typescript
interface UpdateConfigParams {
  id: number;        // 配置ID（必填）
  name: string;      // 配置名称（必填）
  type: string;      // 配置类型（必填）
  data?: any;        // 配置数据（可选）
  remark?: string;   // 备注（可选）
  updateBy: number;  // 更新者ID（必填）
}
```

#### 请求示例
```typescript
// 更新配置
await configApi.update({
  id: 1,
  name: '系统配置',
  type: 'system_settings',
  data: {
    siteName: '我的网站（已更新）',
    siteUrl: 'https://example.com'
  },
  remark: '系统基础配置',
  updateBy: userId  // 必须传递当前用户ID
});
```

### 3. 其他接口

#### 分页查询 (POST /api/v1/config/page)
```typescript
await configApi.page({
  pageNum: 1,
  pageSize: 10,
  type: 'system_settings',  // 可选：按类型筛选
  name: '系统'               // 可选：按名称模糊查询
});
```

#### 根据类型获取配置列表 (GET /api/v1/config/type)
```typescript
await configApi.getByType('system_settings');
```

#### 根据类型获取配置数据 (GET /api/v1/config/data)
```typescript
const data = await configApi.getData('system_settings');
// 返回第一个匹配配置的 data 字段
```

#### 获取配置详情 (GET /api/v1/config/:id)
```typescript
await configApi.detail(1);
```

#### 删除配置 (DELETE /api/v1/config/:id)
```typescript
await configApi.delete(1);
```

#### 批量删除配置 (DELETE /api/v1/config/batch)
```typescript
await configApi.batchDelete([1, 2, 3]);
```

## 重要注意事项

### 1. 必填字段
创建和更新配置时，以下字段是必填的：
- **创建时**：`name`, `type`, `createBy`, `updateBy`
- **更新时**：`id`, `name`, `type`, `updateBy`

### 2. 用户ID获取
在实际使用中，`createBy` 和 `updateBy` 应该从当前登录用户信息中获取：

```typescript
import { useUserStore } from '@/store/user';

const userStore = useUserStore();
const userId = userStore.userInfo?.id;

if (!userId) {
  message.error('用户信息获取失败');
  return;
}
```

### 3. 数据格式
`data` 字段支持任意JSON格式的数据：

```typescript
// 简单对象
data: { key: 'value' }

// 复杂嵌套对象
data: {
  settings: {
    theme: 'dark',
    language: 'zh-CN'
  },
  features: ['feature1', 'feature2']
}

// 数组
data: [1, 2, 3]
```

### 4. 类型安全
使用 TypeScript 类型定义确保参数正确：

```typescript
// ✅ 正确：使用明确的类型
const params: CreateConfigParams = {
  name: '配置名称',
  type: 'config_type',
  createBy: userId,
  updateBy: userId
};
await configApi.create(params);

// ❌ 错误：缺少必填字段
await configApi.create({
  name: '配置名称',
  type: 'config_type'
  // 缺少 createBy 和 updateBy，TypeScript 会报错
});
```

## 完整使用示例

### 配置管理页面示例
```typescript
import { ref } from 'vue';
import { message } from 'ant-design-vue';
import { configApi, type CreateConfigParams, type UpdateConfigParams } from '@/api/config';
import { useUserStore } from '@/store/user';

const userStore = useUserStore();

// 创建配置
const handleCreate = async (formData: any) => {
  const userId = userStore.userInfo?.id;
  if (!userId) {
    message.error('用户信息获取失败');
    return;
  }

  const params: CreateConfigParams = {
    name: formData.name,
    type: formData.type,
    data: formData.data,
    remark: formData.remark,
    createBy: userId,
    updateBy: userId
  };

  try {
    await configApi.create(params);
    message.success('创建成功');
  } catch (error) {
    message.error('创建失败');
  }
};

// 更新配置
const handleUpdate = async (id: number, formData: any) => {
  const userId = userStore.userInfo?.id;
  if (!userId) {
    message.error('用户信息获取失败');
    return;
  }

  const params: UpdateConfigParams = {
    id,
    name: formData.name,
    type: formData.type,
    data: formData.data,
    remark: formData.remark,
    updateBy: userId
  };

  try {
    await configApi.update(params);
    message.success('更新成功');
  } catch (error) {
    message.error('更新失败');
  }
};
```

## 相关文档

- [配置管理功能说明](../../03-功能模块/配置管理功能说明.md)
- [前后端接口一致性修复报告](./前后端接口一致性修复报告.md)

## 总结

配置接口的参数定义已完善，确保了前后端的类型一致性。在使用时需要注意：
1. 创建和更新时必须传递用户ID
2. 使用 TypeScript 类型定义确保参数正确
3. data 字段支持任意JSON格式
4. 从用户store中获取当前用户ID
