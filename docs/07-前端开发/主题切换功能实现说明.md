# 主题切换功能实现说明

## 功能概述

实现了日间/夜间模式切换功能，用户可以通过页面右上角的灯泡图标在两种主题模式之间切换。

## 实现方案

采用 **Ant Design Vue 主题配置方案**，利用官方提供的 `theme.darkAlgorithm` 实现暗色主题。

## 技术架构

### 1. 主题 Store

**文件**: `web/src/stores/theme.ts`

```typescript
export const useThemeStore = defineStore('theme', {
  state: (): ThemeState => ({
    mode: 'light',
  }),

  getters: {
    isDark: (state) => state.mode === 'dark',
    
    // Ant Design Vue 主题配置
    antdTheme: (state) => {
      if (state.mode === 'dark') {
        return {
          algorithm: theme.darkAlgorithm,
          token: {
            colorPrimary: '#1890ff',
          },
        };
      }
      
      return {
        algorithm: theme.defaultAlgorithm,
        token: {
          colorPrimary: '#1890ff',
        },
      };
    },
  },

  actions: {
    toggleTheme() {
      this.mode = this.mode === 'light' ? 'dark' : 'light';
    },
  },
});
```

**功能**：
- 管理主题状态（light/dark）
- 提供 Ant Design Vue 主题配置
- 支持主题切换
- 持久化到 localStorage

### 2. App.vue 配置

**文件**: `web/src/App.vue`

```vue
<template>
  <a-config-provider :locale="zhCN" :theme="themeStore.antdTheme">
    <router-view />
  </a-config-provider>
</template>

<script setup lang="ts">
import { onMounted } from 'vue';
import { useThemeStore } from '@/stores/theme';

const themeStore = useThemeStore();

onMounted(() => {
  themeStore.initTheme();
});
</script>
```

**功能**：
- 使用 ConfigProvider 包裹整个应用
- 动态绑定主题配置
- 初始化主题设置

### 3. 布局组件

**文件**: `web/src/layouts/default/index.vue`

```vue
<a-tooltip :title="themeStore.isDark ? '切换到日间模式' : '切换到夜间模式'">
  <a-button
    type="text"
    :icon="themeStore.isDark ? h(BulbFilled) : h(BulbOutlined)"
    @click="themeStore.toggleTheme"
    class="theme-toggle"
  />
</a-tooltip>
```

**功能**：
- 在页面右上角显示主题切换按钮
- 根据当前主题显示不同图标
- 点击切换主题

## 文件清单

### 新增文件
- `web/src/stores/theme.ts` - 主题状态管理

### 修改文件
- `web/src/App.vue` - 添加 ConfigProvider 和主题配置
- `web/src/layouts/default/index.vue` - 添加主题切换按钮

## 使用说明

### 用户操作

1. 点击页面右上角的灯泡图标
2. 系统自动切换主题模式
3. 主题设置自动保存到 localStorage

### 主题效果

**日间模式**：
- 亮色背景
- 深色文字
- 灯泡轮廓图标

**夜间模式**：
- 暗色背景
- 浅色文字
- 灯泡填充图标

## 技术特点

### 1. 官方支持

使用 Ant Design Vue 官方提供的主题系统：
- `theme.defaultAlgorithm` - 默认亮色主题
- `theme.darkAlgorithm` - 暗色主题算法

### 2. 自动适配

所有 Ant Design 组件自动应用主题：
- 表格、表单、按钮等组件
- 弹窗、抽屉、消息提示
- 菜单、导航、布局

### 3. 持久化

主题设置自动保存：
- 存储位置：localStorage
- 存储键：`theme-mode`
- 刷新页面保持主题

### 4. 平滑切换

主题切换动画：
- 按钮旋转动画
- 颜色过渡效果
- 无闪烁切换

## 自定义配置

### 修改主题色

在 `web/src/stores/theme.ts` 中修改 `token.colorPrimary`：

```typescript
token: {
  colorPrimary: '#1890ff',  // 修改为你的主题色
}
```

### 添加更多主题

扩展 `ThemeMode` 类型：

```typescript
export type ThemeMode = 'light' | 'dark' | 'auto';
```

### 自定义暗色主题

在 `antdTheme` getter 中自定义 token：

```typescript
if (state.mode === 'dark') {
  return {
    algorithm: theme.darkAlgorithm,
    token: {
      colorPrimary: '#1890ff',
      colorBgContainer: '#141414',  // 容器背景色
      colorBgElevated: '#1f1f1f',   // 浮层背景色
      colorBorder: '#434343',        // 边框颜色
      // 更多 token 配置...
    },
  };
}
```

## 浏览器兼容性

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

## 性能优化

1. **按需加载**：主题配置按需计算
2. **缓存优化**：使用 Pinia 的 getter 缓存
3. **最小重渲染**：只更新必要的组件

## 已知问题

1. **自定义样式**：项目中的自定义 CSS 需要手动适配暗色主题
2. **第三方组件**：非 Ant Design 组件需要单独处理

## 未来扩展

1. **跟随系统**：支持自动跟随系统主题
2. **更多主题**：支持多种预设主题
3. **主题编辑器**：可视化主题配置工具

## 参考资料

- [Ant Design Vue 主题定制](https://antdv.com/docs/vue/customize-theme-cn)
- [Design Token](https://ant.design/docs/react/customize-theme-cn#theme)

## 修改时间

2026-01-01
