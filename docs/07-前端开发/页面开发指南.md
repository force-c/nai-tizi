# 前端页面开发指南

本文档说明如何基于现有的动态路由架构快速开发业务页面。

---

## 开发流程

### 1. 后端配置菜单

在数据库中添加菜单配置：

```sql
-- 示例：添加用户管理菜单
INSERT INTO s_menu (menu_name, parent_id, path, component, menu_type, perms, icon, sort_order, visible, status)
VALUES ('用户管理', 1, 'user', 'system/user/index', 'C', 'user.read', 'user', 1, '0', '0');

-- 添加操作按钮
INSERT INTO s_menu (menu_name, parent_id, path, component, menu_type, perms, icon, sort_order, visible, status)
VALUES 
  ('新增用户', (SELECT menu_id FROM s_menu WHERE menu_name = '用户管理'), '', '', 'F', 'user.create', '#', 1, '0', '0'),
  ('编辑用户', (SELECT menu_id FROM s_menu WHERE menu_name = '用户管理'), '', '', 'F', 'user.update', '#', 2, '0', '0'),
  ('删除用户', (SELECT menu_id FROM s_menu WHERE menu_name = '用户管理'), '', '', 'F', 'user.delete', '#', 3, '0', '0');
```

### 2. 创建 API 接口

创建文件：`src/api/user/index.ts`

```typescript
import { request } from '@/utils/request';
import type { User } from '@/types/system';
import type { PageParams, PageResponse } from '@/types/api';

export const userApi = {
  // 获取用户列表
  list: (params: PageParams & { username?: string; status?: string }) =>
    request.get<PageResponse<User>>('/api/v1/users', { params }),

  // 获取用户详情
  detail: (userId: number) =>
    request.get<User>(`/api/v1/users/${userId}`),

  // 创建用户
  create: (data: Partial<User>) =>
    request.post('/api/v1/users', data),

  // 更新用户
  update: (userId: number, data: Partial<User>) =>
    request.put(`/api/v1/users/${userId}`, data),

  // 删除用户
  delete: (userId: number) =>
    request.delete(`/api/v1/users/${userId}`),

  // 批量删除
  batchDelete: (userIds: number[]) =>
    request.post('/api/v1/users/batch-delete', { userIds }),

  // 重置密码
  resetPassword: (userId: number) =>
    request.post(`/api/v1/users/${userId}/reset-password`),
};
```

### 3. 创建页面组件

创建文件：`src/views/system/user/index.vue`

```vue
<template>
  <div class="user-page">
    <!-- 搜索栏 -->
    <a-card class="search-card" :bordered="false">
      <a-form layout="inline" :model="searchForm">
        <a-form-item label="用户名">
          <a-input
            v-model:value="searchForm.username"
            placeholder="请输入用户名"
            allow-clear
          />
        </a-form-item>
        <a-form-item label="状态">
          <a-select
            v-model:value="searchForm.status"
            placeholder="请选择状态"
            allow-clear
            style="width: 120px"
          >
            <a-select-option value="0">正常</a-select-option>
            <a-select-option value="1">停用</a-select-option>
          </a-select>
        </a-form-item>
        <a-form-item>
          <a-space>
            <a-button type="primary" @click="handleSearch">
              <search-outlined />
              搜索
            </a-button>
            <a-button @click="handleReset">
              <redo-outlined />
              重置
            </a-button>
          </a-space>
        </a-form-item>
      </a-form>
    </a-card>

    <!-- 操作栏 -->
    <a-card class="table-card" :bordered="false">
      <div class="table-toolbar">
        <a-space>
          <a-button
            v-if="hasPermission('user.create')"
            type="primary"
            @click="handleCreate"
          >
            <plus-outlined />
            新增
          </a-button>
          <a-button
            v-if="hasPermission('user.delete')"
            danger
            :disabled="selectedRowKeys.length === 0"
            @click="handleBatchDelete"
          >
            <delete-outlined />
            批量删除
          </a-button>
        </a-space>
      </div>

      <!-- 表格 -->
      <a-table
        :columns="columns"
        :data-source="dataSource"
        :loading="loading"
        :pagination="pagination"
        :row-selection="{
          selectedRowKeys,
          onChange: onSelectChange,
        }"
        row-key="userId"
        @change="handleTableChange"
      >
        <template #bodyCell="{ column, record }">
          <template v-if="column.key === 'status'">
            <a-tag :color="record.status === '0' ? 'success' : 'error'">
              {{ record.status === '0' ? '正常' : '停用' }}
            </a-tag>
          </template>
          <template v-else-if="column.key === 'action'">
            <a-space>
              <a-button
                v-if="hasPermission('user.update')"
                type="link"
                size="small"
                @click="handleEdit(record)"
              >
                编辑
              </a-button>
              <a-button
                v-if="hasPermission('user.delete')"
                type="link"
                size="small"
                danger
                @click="handleDelete(record)"
              >
                删除
              </a-button>
            </a-space>
          </template>
        </template>
      </a-table>
    </a-card>

    <!-- 新增/编辑弹窗 -->
    <a-modal
      v-model:visible="modalVisible"
      :title="modalTitle"
      :width="600"
      @ok="handleSubmit"
      @cancel="handleCancel"
    >
      <a-form
        ref="formRef"
        :model="formData"
        :rules="rules"
        :label-col="{ span: 6 }"
        :wrapper-col="{ span: 16 }"
      >
        <a-form-item label="用户名" name="username">
          <a-input v-model:value="formData.username" placeholder="请输入用户名" />
        </a-form-item>
        <a-form-item label="昵称" name="nickname">
          <a-input v-model:value="formData.nickname" placeholder="请输入昵称" />
        </a-form-item>
        <a-form-item label="邮箱" name="email">
          <a-input v-model:value="formData.email" placeholder="请输入邮箱" />
        </a-form-item>
        <a-form-item label="手机号" name="phonenumber">
          <a-input v-model:value="formData.phonenumber" placeholder="请输入手机号" />
        </a-form-item>
        <a-form-item label="状态" name="status">
          <a-radio-group v-model:value="formData.status">
            <a-radio value="0">正常</a-radio>
            <a-radio value="1">停用</a-radio>
          </a-radio-group>
        </a-form-item>
      </a-form>
    </a-modal>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue';
import { message, Modal } from 'ant-design-vue';
import {
  SearchOutlined,
  RedoOutlined,
  PlusOutlined,
  DeleteOutlined,
} from '@ant-design/icons-vue';
import { usePermissionStore } from '@/stores/permission';
import { userApi } from '@/api/user';
import type { User } from '@/types/system';

const permissionStore = usePermissionStore();
const hasPermission = permissionStore.hasPermission;

// 搜索表单
const searchForm = reactive({
  username: '',
  status: undefined,
});

// 表格数据
const loading = ref(false);
const dataSource = ref<User[]>([]);
const selectedRowKeys = ref<number[]>([]);

// 分页
const pagination = reactive({
  current: 1,
  pageSize: 10,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total: number) => `共 ${total} 条`,
});

// 表格列
const columns = [
  { title: '用户ID', dataIndex: 'userId', key: 'userId', width: 80 },
  { title: '用户名', dataIndex: 'username', key: 'username' },
  { title: '昵称', dataIndex: 'nickname', key: 'nickname' },
  { title: '邮箱', dataIndex: 'email', key: 'email' },
  { title: '手机号', dataIndex: 'phonenumber', key: 'phonenumber' },
  { title: '状态', dataIndex: 'status', key: 'status', width: 80 },
  { title: '创建时间', dataIndex: 'createTime', key: 'createTime', width: 180 },
  { title: '操作', key: 'action', width: 150, fixed: 'right' },
];

// 弹窗
const modalVisible = ref(false);
const modalTitle = ref('');
const formRef = ref();
const formData = reactive<Partial<User>>({
  username: '',
  nickname: '',
  email: '',
  phonenumber: '',
  status: '0',
});

// 表单验证规则
const rules = {
  username: [{ required: true, message: '请输入用户名', trigger: 'blur' }],
  nickname: [{ required: true, message: '请输入昵称', trigger: 'blur' }],
  email: [{ type: 'email', message: '请输入正确的邮箱', trigger: 'blur' }],
};

// 加载数据
const loadData = async () => {
  try {
    loading.value = true;
    const res = await userApi.list({
      pageNum: pagination.current,
      pageSize: pagination.pageSize,
      ...searchForm,
    });
    dataSource.value = res.list;
    pagination.total = res.total;
  } catch (error: any) {
    message.error(error.message || '加载数据失败');
  } finally {
    loading.value = false;
  }
};

// 搜索
const handleSearch = () => {
  pagination.current = 1;
  loadData();
};

// 重置
const handleReset = () => {
  searchForm.username = '';
  searchForm.status = undefined;
  pagination.current = 1;
  loadData();
};

// 表格变化
const handleTableChange = (pag: any) => {
  pagination.current = pag.current;
  pagination.pageSize = pag.pageSize;
  loadData();
};

// 选择行
const onSelectChange = (keys: number[]) => {
  selectedRowKeys.value = keys;
};

// 新增
const handleCreate = () => {
  modalTitle.value = '新增用户';
  modalVisible.value = true;
  Object.assign(formData, {
    userId: undefined,
    username: '',
    nickname: '',
    email: '',
    phonenumber: '',
    status: '0',
  });
};

// 编辑
const handleEdit = (record: User) => {
  modalTitle.value = '编辑用户';
  modalVisible.value = true;
  Object.assign(formData, record);
};

// 删除
const handleDelete = (record: User) => {
  Modal.confirm({
    title: '确认删除',
    content: `确定要删除用户"${record.username}"吗？`,
    onOk: async () => {
      try {
        await userApi.delete(record.userId);
        message.success('删除成功');
        loadData();
      } catch (error: any) {
        message.error(error.message || '删除失败');
      }
    },
  });
};

// 批量删除
const handleBatchDelete = () => {
  Modal.confirm({
    title: '确认删除',
    content: `确定要删除选中的 ${selectedRowKeys.value.length} 个用户吗？`,
    onOk: async () => {
      try {
        await userApi.batchDelete(selectedRowKeys.value);
        message.success('删除成功');
        selectedRowKeys.value = [];
        loadData();
      } catch (error: any) {
        message.error(error.message || '删除失败');
      }
    },
  });
};

// 提交表单
const handleSubmit = async () => {
  try {
    await formRef.value.validate();
    if (formData.userId) {
      await userApi.update(formData.userId, formData);
      message.success('更新成功');
    } else {
      await userApi.create(formData);
      message.success('创建成功');
    }
    modalVisible.value = false;
    loadData();
  } catch (error: any) {
    if (error.errorFields) {
      // 表单验证错误
      return;
    }
    message.error(error.message || '操作失败');
  }
};

// 取消
const handleCancel = () => {
  modalVisible.value = false;
  formRef.value?.resetFields();
};

// 初始化
onMounted(() => {
  loadData();
});
</script>

<style scoped>
.user-page {
  padding: 16px;
}

.search-card {
  margin-bottom: 16px;
}

.table-toolbar {
  margin-bottom: 16px;
}
</style>
```

---

## 页面模板说明

### 核心功能

1. **搜索栏** - 条件筛选
2. **操作栏** - 新增、批量删除等
3. **数据表格** - 列表展示
4. **分页** - 数据分页
5. **弹窗表单** - 新增/编辑
6. **权限控制** - 按钮级权限

### 权限控制

```vue
<!-- 按钮权限 -->
<a-button v-if="hasPermission('user.create')">新增</a-button>

<!-- 脚本中 -->
<script setup>
import { usePermissionStore } from '@/stores/permission';

const permissionStore = usePermissionStore();
const hasPermission = permissionStore.hasPermission;
</script>
```

### API 调用

```typescript
// 列表查询
const res = await userApi.list({ pageNum: 1, pageSize: 10 });

// 创建
await userApi.create(data);

// 更新
await userApi.update(id, data);

// 删除
await userApi.delete(id);
```

---

## 其他页面开发

基于上面的模板，可以快速开发其他页面：

### 角色管理

1. 复制用户管理页面
2. 修改 API 调用为 `roleApi`
3. 修改表格列定义
4. 修改表单字段
5. 添加权限配置功能

### 菜单管理

1. 使用树形表格组件
2. 添加图标选择器
3. 添加父菜单选择
4. 支持拖拽排序

### 存储环境管理

1. 复制用户管理页面
2. 修改为存储环境相关字段
3. 添加配置 JSON 编辑器
4. 添加测试连接功能

---

## 开发建议

### 1. 使用组合式函数

创建可复用的逻辑：

```typescript
// composables/useTable.ts
export function useTable(api: any) {
  const loading = ref(false);
  const dataSource = ref([]);
  const pagination = reactive({
    current: 1,
    pageSize: 10,
    total: 0,
  });

  const loadData = async (params?: any) => {
    try {
      loading.value = true;
      const res = await api.list({
        pageNum: pagination.current,
        pageSize: pagination.pageSize,
        ...params,
      });
      dataSource.value = res.list;
      pagination.total = res.total;
    } finally {
      loading.value = false;
    }
  };

  return {
    loading,
    dataSource,
    pagination,
    loadData,
  };
}
```

### 2. 提取通用组件

- `BasicTable` - 基础表格
- `BasicForm` - 基础表单
- `BasicModal` - 基础弹窗
- `SearchForm` - 搜索表单

### 3. 统一样式

创建全局样式变量：

```css
/* assets/styles/variables.css */
:root {
  --card-margin: 16px;
  --toolbar-margin: 16px;
  --table-padding: 16px;
}
```

---

## 总结

基于现有的动态路由架构，开发新页面的步骤：

1. ✅ 后端配置菜单（SQL）
2. ✅ 创建 API 接口（TypeScript）
3. ✅ 创建页面组件（Vue）
4. ✅ 重新登录测试

**无需修改路由配置，非常高效！**

---

**创建时间：** 2024-12-21
