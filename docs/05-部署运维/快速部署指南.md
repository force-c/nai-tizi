# å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›é¡¹ç›®çš„å¿«é€Ÿéƒ¨ç½²æŒ‡å—ï¼Œå¸®åŠ©ä½ åœ¨å‡ åˆ†é’Ÿå†…å¯åŠ¨å®Œæ•´çš„å¼€å‘æˆ–ç”Ÿäº§ç¯å¢ƒã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker å’Œ Docker Compose
- Git
- è‡³å°‘ 4GB å¯ç”¨å†…å­˜

### ä¸€é”®å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd nai-tizi

# 2. åˆ›å»ºç½‘ç»œ
docker network create app-network

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œä¿®æ”¹å¿…è¦çš„é…ç½®

# 4. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 5. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 6. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f api
```

### å¯åŠ¨ç›‘æ§ç³»ç»Ÿ

```bash
# å¯åŠ¨ç›‘æ§æœåŠ¡
docker-compose -f docker-compose.monitoring.yml up -d

# æŸ¥çœ‹ç›‘æ§æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.monitoring.yml ps
```

---

## ğŸŒ è®¿é—®æœåŠ¡

### åº”ç”¨æœåŠ¡
- **API æœåŠ¡**: http://localhost:8080
- **API æ–‡æ¡£**: http://localhost:8080/swagger/index.html
- **å¥åº·æ£€æŸ¥**: http://localhost:8080/health

### æ•°æ®åº“å’Œç¼“å­˜
- **PostgreSQL**: localhost:5432
- **Redis**: localhost:6379
- **MinIO Console**: http://localhost:9001 (minioadmin/minioadmin)

### ç›‘æ§æœåŠ¡
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin)
- **Jaeger**: http://localhost:16686
- **Alertmanager**: http://localhost:9093

---

## ğŸ“ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# æ•°æ®åº“é…ç½®
DB_HOST=postgres
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your_secure_password  # ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹
DB_NAME=nai_tizi

# Redis é…ç½®
REDIS_HOST=redis
REDIS_PORT=6379

# JWT é…ç½®
JWT_SECRET=your_jwt_secret_key_change_this_in_production  # ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹

# åº”ç”¨é…ç½®
APP_ENV=production
LOG_LEVEL=info
```

### åº”ç”¨é…ç½®æ–‡ä»¶

ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š`cmd/api/conf.prod.yaml`

```yaml
server:
  port: 8080
  mode: release

database:
  host: ${DB_HOST}
  port: ${DB_PORT}
  user: ${DB_USER}
  password: ${DB_PASSWORD}
  dbname: ${DB_NAME}

redis:
  host: ${REDIS_HOST}
  port: ${REDIS_PORT}

jwt:
  secret: ${JWT_SECRET}
  access_token_expire: 3600
  refresh_token_expire: 604800
```

---

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹ API æ—¥å¿—
docker-compose logs -f api

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
docker-compose logs --tail=100 api
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯ API æœåŠ¡
docker-compose restart api

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

### è¿›å…¥å®¹å™¨

```bash
# è¿›å…¥ API å®¹å™¨
docker exec -it nai-tizi-api sh

# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker exec -it nai-tizi-postgres psql -U postgres -d nai_tizi

# è¿›å…¥ Redis å®¹å™¨
docker exec -it nai-tizi-redis redis-cli
```

### æ•°æ®åº“æ“ä½œ

```bash
# æ‰§è¡Œ SQL æ–‡ä»¶
docker exec -i nai-tizi-postgres psql -U postgres -d nai_tizi < scripts/sql/pgsql.sql

# å¤‡ä»½æ•°æ®åº“
docker exec nai-tizi-postgres pg_dump -U postgres nai_tizi > backup.sql

# æ¢å¤æ•°æ®åº“
docker exec -i nai-tizi-postgres psql -U postgres -d nai_tizi < backup.sql
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs api

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8080

# æ¸…ç†å¹¶é‡å¯
docker-compose down
docker-compose up -d
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å°±ç»ª
docker-compose logs postgres

# æµ‹è¯•æ•°æ®åº“è¿æ¥
docker exec -it nai-tizi-postgres psql -U postgres -d nai_tizi -c "SELECT 1"

# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network inspect app-network
```

### å†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
docker system prune -a

# é™åˆ¶å®¹å™¨å†…å­˜ï¼ˆåœ¨ docker-compose.yml ä¸­ï¼‰
deploy:
  resources:
    limits:
      memory: 1G
```

---

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
- [ ] é…ç½® HTTPS/TLS
- [ ] å¯ç”¨é˜²ç«å¢™è§„åˆ™
- [ ] é…ç½®å¤‡ä»½ç­–ç•¥
- [ ] è®¾ç½®ç›‘æ§å‘Šè­¦
- [ ] é™åˆ¶å®¹å™¨èµ„æº
- [ ] é…ç½®æ—¥å¿—è½®è½¬
- [ ] å¯ç”¨è®¿é—®æ§åˆ¶

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```bash
# 1. ä½¿ç”¨ç”Ÿäº§é…ç½®
cp cmd/api/conf.dev.yaml cmd/api/conf.prod.yaml
vim cmd/api/conf.prod.yaml

# 2. é…ç½®ç¯å¢ƒå˜é‡
vim .env

# 3. ä½¿ç”¨ç”Ÿäº§ docker-compose
docker-compose -f docker-compose.prod.yml up -d
```

### æ€§èƒ½ä¼˜åŒ–

```yaml
# docker-compose.prod.yml
services:
  api:
    deploy:
      replicas: 2  # å¤šå®ä¾‹
      resources:
        limits:
          cpus: '1'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
```

---

## ğŸ“Š ç›‘æ§é…ç½®

### Prometheus æŒ‡æ ‡

è®¿é—® http://localhost:9090 æŸ¥çœ‹æŒ‡æ ‡ï¼š

- `http_requests_total` - HTTP è¯·æ±‚æ€»æ•°
- `http_request_duration_seconds` - è¯·æ±‚å»¶è¿Ÿ
- `db_query_duration_seconds` - æ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿ
- `redis_operation_duration_seconds` - Redis æ“ä½œå»¶è¿Ÿ

### Grafana Dashboard

1. è®¿é—® http://localhost:3000
2. ç™»å½• (admin/admin)
3. æ·»åŠ  Prometheus æ•°æ®æº
4. å¯¼å…¥é¢„é…ç½®çš„ Dashboard

### å‘Šè­¦é…ç½®

ç¼–è¾‘ `monitoring/alerts/api-alerts.yml` é…ç½®å‘Šè­¦è§„åˆ™ï¼š

- API æœåŠ¡ä¸å¯ç”¨
- é«˜é”™è¯¯ç‡ï¼ˆ>5%ï¼‰
- é«˜å»¶è¿Ÿï¼ˆP95 >1sï¼‰
- CPU/å†…å­˜/ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜

---

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### æ›´æ–°åº”ç”¨

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull

# 2. é‡æ–°æ„å»ºé•œåƒ
docker-compose build

# 3. é‡å¯æœåŠ¡
docker-compose up -d

# 4. éªŒè¯æ›´æ–°
curl http://localhost:8080/health
```

### æ•°æ®å¤‡ä»½

```bash
# è‡ªåŠ¨å¤‡ä»½è„šæœ¬
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
docker exec nai-tizi-postgres pg_dump -U postgres nai_tizi > backup_$DATE.sql
```

### æ—¥å¿—ç®¡ç†

```bash
# æ¸…ç†æ—§æ—¥å¿—
docker-compose logs --tail=0 -f > /dev/null

# é…ç½®æ—¥å¿—è½®è½¬ï¼ˆåœ¨ docker-compose.yml ä¸­ï¼‰
logging:
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Docker éƒ¨ç½²æŒ‡å—](./Dockeréƒ¨ç½²æŒ‡å—.md) - è¯¦ç»†çš„ Docker é…ç½®è¯´æ˜
- [ç›‘æ§ç³»ç»Ÿé…ç½®](./ç›‘æ§ç³»ç»Ÿé…ç½®.md) - å®Œæ•´çš„ç›‘æ§ç³»ç»Ÿé…ç½®
- [Kubernetes éƒ¨ç½²æŒ‡å—](./Kuberneteséƒ¨ç½²æŒ‡å—.md) - K8s éƒ¨ç½²æ–¹æ¡ˆ
- [åŠŸèƒ½ç¼ºå¤±åˆ†æ](../08-é¡¹ç›®æ€»ç»“/åå°ç®¡ç†ç³»ç»Ÿè„šæ‰‹æ¶åŠŸèƒ½ç¼ºå¤±åˆ†æ.md) - ç³»ç»ŸåŠŸèƒ½è¯„ä¼°

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ

1. ä½¿ç”¨ docker-compose å¿«é€Ÿå¯åŠ¨
2. æŒ‚è½½æœ¬åœ°ä»£ç ç›®å½•å®ç°çƒ­é‡è½½
3. ä½¿ç”¨å¼€å‘é…ç½®æ–‡ä»¶
4. å¯ç”¨è¯¦ç»†æ—¥å¿—

### ç”Ÿäº§ç¯å¢ƒ

1. ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿé…ç½®
2. å¯ç”¨å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯
3. é…ç½®èµ„æºé™åˆ¶
4. å¯ç”¨ç›‘æ§å’Œå‘Šè­¦
5. å®šæœŸå¤‡ä»½æ•°æ®
6. ä½¿ç”¨ HTTPS
7. å®æ–½è®¿é—®æ§åˆ¶

---

## ğŸ†˜ è·å–å¸®åŠ©

### å¸¸è§é—®é¢˜

**Q: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ**
A: ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„ï¼Œä¾‹å¦‚å°† `8080:8080` æ”¹ä¸º `8081:8080`

**Q: å¦‚ä½•æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼Ÿ**
A: ä½¿ç”¨ `docker-compose logs -f api`

**Q: å¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ**
A: æ‰§è¡Œ `docker-compose down -v` åˆ é™¤æ•°æ®å·ï¼Œç„¶åé‡æ–°å¯åŠ¨

**Q: å¦‚ä½•æ‰©å±•æœåŠ¡å®ä¾‹ï¼Ÿ**
A: ä½¿ç”¨ `docker-compose up -d --scale api=3` å¯åŠ¨ 3 ä¸ª API å®ä¾‹

### æŠ€æœ¯æ”¯æŒ

- æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼š`docs/` ç›®å½•
- æäº¤ Issueï¼šé¡¹ç›® GitHub ä»“åº“
- æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs`

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2026-01-12  
**ç»´æŠ¤è€…ï¼š** é¡¹ç›®å›¢é˜Ÿ
