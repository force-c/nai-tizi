# éªŒè¯ç é…ç½®è¯´æ˜

## æ¦‚è¿°

ç³»ç»Ÿæ”¯æŒä¸‰ç§éªŒè¯ç ç±»å‹ï¼Œå¯é€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶æ˜¯å¦å¯ç”¨ã€‚

## é…ç½®é¡¹

### é…ç½®æ–‡ä»¶ä½ç½®

```
cmd/api/conf.dev.yaml
```

### éªŒè¯ç é…ç½®

```yaml
auth:
  captchaEnabled: false    # å›¾å½¢éªŒè¯ç ï¼ˆå¯†ç ç™»å½•æ—¶ï¼‰
  smsCodeEnabled: true     # çŸ­ä¿¡éªŒè¯ç 
  emailCodeEnabled: true   # é‚®ç®±éªŒè¯ç 
```

## éªŒè¯ç ç±»å‹

### 1. å›¾å½¢éªŒè¯ç ï¼ˆCaptchaï¼‰

**ç”¨é€”**ï¼šå¯†ç ç™»å½•æ—¶çš„é¢å¤–å®‰å…¨éªŒè¯

**é…ç½®**ï¼š
```yaml
auth:
  captchaEnabled: false  # é»˜è®¤å…³é—­
```

**å¯ç”¨åçš„è¡Œä¸º**ï¼š
- å¯†ç ç™»å½•æ—¶**å¿…é¡»**æä¾›å›¾å½¢éªŒè¯ç 
- éœ€è¦å…ˆè°ƒç”¨è·å–éªŒè¯ç æ¥å£ï¼ˆå¾…å®ç°ï¼‰
- éªŒè¯ç å­˜å‚¨åœ¨ Redisï¼Œæœ‰æ•ˆæœŸ 5 åˆ†é’Ÿ

**ç™»å½•è¯·æ±‚ç¤ºä¾‹**ï¼ˆå¯ç”¨æ—¶ï¼‰ï¼š
```json
{
  "clientKey": "web-admin",
  "clientSecret": "web-secret-2024",
  "grantType": "password",
  "username": "admin",
  "password": "admin123",
  "uuid": "captcha-uuid-12345",
  "code": "ABCD"
}
```

**æœªå¯ç”¨æ—¶**ï¼š
- `uuid` å’Œ `code` å­—æ®µå¯é€‰
- å³ä½¿æä¾›ä¹Ÿä¸ä¼šéªŒè¯

### 2. çŸ­ä¿¡éªŒè¯ç ï¼ˆSMS Codeï¼‰

**ç”¨é€”**ï¼šå¾®ä¿¡å°ç¨‹åºç™»å½•ã€æ‰‹æœºå·ç™»å½•

**é…ç½®**ï¼š
```yaml
auth:
  smsCodeEnabled: true  # é»˜è®¤å¼€å¯
```

**ç›¸å…³æ¥å£**ï¼š
- `POST /auth/sms` - å‘é€çŸ­ä¿¡éªŒè¯ç 
- `POST /login` (grantType=xcx) - å¾®ä¿¡å°ç¨‹åºç™»å½•

**å‘é€éªŒè¯ç è¯·æ±‚**ï¼š
```json
{
  "phonenumber": "13800138000"
}
```

**ç™»å½•è¯·æ±‚ç¤ºä¾‹**ï¼š
```json
{
  "clientKey": "wechat-xcx",
  "clientSecret": "xcx-secret-2024",
  "grantType": "xcx",
  "phonenumber": "13800138000",
  "code": "123456",
  "wxCode": "wx-code-from-wechat"
}
```

**å…³é—­åçš„è¡Œä¸º**ï¼š
- `/auth/sms` æ¥å£è¿”å› 403 é”™è¯¯
- å¾®ä¿¡å°ç¨‹åºç™»å½•ä¼šå¤±è´¥ï¼ˆå› ä¸ºéœ€è¦çŸ­ä¿¡éªŒè¯ç ï¼‰

### 3. é‚®ç®±éªŒè¯ç ï¼ˆEmail Codeï¼‰

**ç”¨é€”**ï¼šé‚®ç®±éªŒè¯ç ç™»å½•

**é…ç½®**ï¼š
```yaml
auth:
  emailCodeEnabled: true  # é»˜è®¤å¼€å¯
```

**ç›¸å…³æ¥å£**ï¼š
- `POST /auth/email` - å‘é€é‚®ç®±éªŒè¯ç 
- `POST /login` (grantType=email) - é‚®ç®±ç™»å½•

**å‘é€éªŒè¯ç è¯·æ±‚**ï¼š
```json
{
  "email": "admin@example.com"
}
```

**ç™»å½•è¯·æ±‚ç¤ºä¾‹**ï¼š
```json
{
  "clientKey": "web-admin",
  "clientSecret": "web-secret-2024",
  "grantType": "email",
  "email": "admin@example.com",
  "code": "123456"
}
```

**å…³é—­åçš„è¡Œä¸º**ï¼š
- `/auth/email` æ¥å£è¿”å› 403 é”™è¯¯
- é‚®ç®±ç™»å½•ä¼šå¤±è´¥ï¼ˆå› ä¸ºéœ€è¦é‚®ç®±éªŒè¯ç ï¼‰

## é…ç½®åœºæ™¯

### åœºæ™¯1ï¼šå¼€å‘ç¯å¢ƒï¼ˆæ¨èé…ç½®ï¼‰

```yaml
auth:
  captchaEnabled: false    # å…³é—­ï¼Œæ–¹ä¾¿æµ‹è¯•
  smsCodeEnabled: true     # å¼€å¯
  emailCodeEnabled: true   # å¼€å¯
```

**è¯´æ˜**ï¼š
- å›¾å½¢éªŒè¯ç å…³é—­ï¼Œå‡å°‘æµ‹è¯•æ­¥éª¤
- çŸ­ä¿¡å’Œé‚®ç®±éªŒè¯ç å¼€å¯ï¼Œæµ‹è¯•å®Œæ•´æµç¨‹

### åœºæ™¯2ï¼šç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èé…ç½®ï¼‰

```yaml
auth:
  captchaEnabled: true     # å¼€å¯ï¼Œé˜²æ­¢æš´åŠ›ç ´è§£
  smsCodeEnabled: true     # å¼€å¯
  emailCodeEnabled: true   # å¼€å¯
```

**è¯´æ˜**ï¼š
- æ‰€æœ‰éªŒè¯ç éƒ½å¼€å¯ï¼Œæœ€å¤§åŒ–å®‰å…¨æ€§
- å›¾å½¢éªŒè¯ç é˜²æ­¢å¯†ç æš´åŠ›ç ´è§£

### åœºæ™¯3ï¼šä»…æ”¯æŒå¯†ç ç™»å½•

```yaml
auth:
  captchaEnabled: true     # å¼€å¯
  smsCodeEnabled: false    # å…³é—­
  emailCodeEnabled: false  # å…³é—­
```

**è¯´æ˜**ï¼š
- åªæ”¯æŒç”¨æˆ·åå¯†ç ç™»å½•
- ä¸æ”¯æŒæ‰‹æœºå·å’Œé‚®ç®±ç™»å½•

### åœºæ™¯4ï¼šæµ‹è¯•ç¯å¢ƒï¼ˆæœ€ç®€é…ç½®ï¼‰

```yaml
auth:
  captchaEnabled: false    # å…³é—­
  smsCodeEnabled: false    # å…³é—­
  emailCodeEnabled: false  # å…³é—­
```

**è¯´æ˜**ï¼š
- æ‰€æœ‰éªŒè¯ç éƒ½å…³é—­
- ä»…ç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•
- **ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ**

## é»˜è®¤å€¼

å¦‚æœé…ç½®æ–‡ä»¶ä¸­æœªè®¾ç½®ï¼Œç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹é»˜è®¤å€¼ï¼š

```yaml
auth:
  captchaEnabled: false    # é»˜è®¤å…³é—­
  smsCodeEnabled: true     # é»˜è®¤å¼€å¯
  emailCodeEnabled: true   # é»˜è®¤å¼€å¯
```

## é”™è¯¯å“åº”

### åŠŸèƒ½æœªå¯ç”¨

å½“éªŒè¯ç åŠŸèƒ½è¢«å…³é—­æ—¶ï¼Œè°ƒç”¨ç›¸å…³æ¥å£ä¼šè¿”å›ï¼š

```json
{
  "code": 403,
  "msg": "çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½æœªå¯ç”¨"
}
```

æˆ–

```json
{
  "code": 403,
  "msg": "é‚®ç®±éªŒè¯ç åŠŸèƒ½æœªå¯ç”¨"
}
```

### å›¾å½¢éªŒè¯ç å¿…å¡«

å½“ `captchaEnabled=true` æ—¶ï¼Œå¯†ç ç™»å½•å¿…é¡»æä¾›éªŒè¯ç ï¼š

```json
{
  "code": 400,
  "msg": "è¯·è¾“å…¥å›¾å½¢éªŒè¯ç "
}
```

## é…ç½®æ›´æ–°æµç¨‹

### 1. ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `cmd/api/conf.dev.yaml`ï¼š

```yaml
auth:
  captchaEnabled: true  # ä¿®æ”¹ä¸º true
```

### 2. é‡å¯æœåŠ¡

```bash
# åœæ­¢æœåŠ¡
Ctrl+C

# é‡æ–°å¯åŠ¨
make run
```

### 3. éªŒè¯é…ç½®

æŸ¥çœ‹æ—¥å¿—ç¡®è®¤é…ç½®å·²åŠ è½½ï¼š

```bash
# æ—¥å¿—ä¸­ä¼šæ˜¾ç¤ºé…ç½®ä¿¡æ¯
```

## å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒ

âœ… **æ¨è**ï¼š
```yaml
auth:
  captchaEnabled: true     # å¼€å¯å›¾å½¢éªŒè¯ç 
  smsCodeEnabled: true     # å¼€å¯çŸ­ä¿¡éªŒè¯ç 
  emailCodeEnabled: true   # å¼€å¯é‚®ç®±éªŒè¯ç 
```

âŒ **ä¸æ¨è**ï¼š
```yaml
auth:
  captchaEnabled: false    # å…³é—­å›¾å½¢éªŒè¯ç ï¼ˆå®¹æ˜“è¢«æš´åŠ›ç ´è§£ï¼‰
```

### å¼€å‘ç¯å¢ƒ

âœ… **æ¨è**ï¼š
```yaml
auth:
  captchaEnabled: false    # å…³é—­ï¼Œæ–¹ä¾¿æµ‹è¯•
  smsCodeEnabled: true     # å¼€å¯
  emailCodeEnabled: true   # å¼€å¯
```

### æµ‹è¯•ç¯å¢ƒ

âœ… **æ¨è**ï¼š
```yaml
auth:
  captchaEnabled: false    # å…³é—­
  smsCodeEnabled: false    # å…³é—­ï¼ˆå¦‚æœæ²¡æœ‰çŸ­ä¿¡æœåŠ¡ï¼‰
  emailCodeEnabled: false  # å…³é—­ï¼ˆå¦‚æœæ²¡æœ‰é‚®ä»¶æœåŠ¡ï¼‰
```

## ç›¸å…³é…ç½®

### å®Œæ•´è®¤è¯é…ç½®

```yaml
auth:
  # Token é…ç½®
  tokenHeader: "Authorization"  # Token è¯·æ±‚å¤´åç§°
  
  # å¹¶å‘ç™»å½•æ§åˆ¶
  allowConcurrent: false         # æ˜¯å¦å…è®¸å¹¶å‘ç™»å½•
  shareToken: false              # æ˜¯å¦å…±äº« Token
  
  # éªŒè¯ç é…ç½®
  captchaEnabled: false          # å›¾å½¢éªŒè¯ç 
  smsCodeEnabled: true           # çŸ­ä¿¡éªŒè¯ç 
  emailCodeEnabled: true         # é‚®ç®±éªŒè¯ç 
```

## å¸¸è§é—®é¢˜

### Q1: ä¿®æ”¹é…ç½®åä¸ç”Ÿæ•ˆï¼Ÿ

A: éœ€è¦é‡å¯æœåŠ¡æ‰èƒ½åŠ è½½æ–°é…ç½®ã€‚

### Q2: å¦‚ä½•ä¸´æ—¶å…³é—­éªŒè¯ç ï¼Ÿ

A: ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†å¯¹åº”çš„ `enabled` è®¾ç½®ä¸º `false`ï¼Œç„¶åé‡å¯æœåŠ¡ã€‚

### Q3: å›¾å½¢éªŒè¯ç æ¥å£åœ¨å“ªé‡Œï¼Ÿ

A: å›¾å½¢éªŒè¯ç ç”Ÿæˆæ¥å£å¾…å®ç°ï¼Œç›®å‰åªæœ‰éªŒè¯é€»è¾‘ã€‚

### Q4: å…³é—­çŸ­ä¿¡éªŒè¯ç åï¼Œå¾®ä¿¡å°ç¨‹åºè¿˜èƒ½ç™»å½•å—ï¼Ÿ

A: ä¸èƒ½ï¼Œå› ä¸ºå¾®ä¿¡å°ç¨‹åºç™»å½•éœ€è¦çŸ­ä¿¡éªŒè¯ç éªŒè¯æ‰‹æœºå·ã€‚

### Q5: å¯ä»¥åªå…³é—­æŸä¸ªå®¢æˆ·ç«¯çš„éªŒè¯ç å—ï¼Ÿ

A: å½“å‰é…ç½®æ˜¯å…¨å±€çš„ï¼Œä¸æ”¯æŒæŒ‰å®¢æˆ·ç«¯é…ç½®ã€‚å¦‚æœ‰éœ€æ±‚ï¼Œéœ€è¦æ‰©å±•é…ç½®ç»“æ„ã€‚

## ç›‘æ§å»ºè®®

### 1. éªŒè¯ç å‘é€é‡

ç›‘æ§æ¯æ—¥éªŒè¯ç å‘é€é‡ï¼Œé˜²æ­¢æ¶æ„åˆ·éªŒè¯ç ï¼š

```
- çŸ­ä¿¡éªŒè¯ç å‘é€é‡
- é‚®ç®±éªŒè¯ç å‘é€é‡
- å›¾å½¢éªŒè¯ç ç”Ÿæˆé‡
```

### 2. éªŒè¯å¤±è´¥ç‡

ç›‘æ§éªŒè¯ç éªŒè¯å¤±è´¥ç‡ï¼š

```
- å›¾å½¢éªŒè¯ç é”™è¯¯ç‡
- çŸ­ä¿¡éªŒè¯ç é”™è¯¯ç‡
- é‚®ç®±éªŒè¯ç é”™è¯¯ç‡
```

### 3. åŠŸèƒ½ä½¿ç”¨ç‡

ç»Ÿè®¡å„ç§ç™»å½•æ–¹å¼çš„ä½¿ç”¨ç‡ï¼š

```
- å¯†ç ç™»å½•å æ¯”
- é‚®ç®±ç™»å½•å æ¯”
- å¾®ä¿¡å°ç¨‹åºç™»å½•å æ¯”
```

## æ€»ç»“

âœ… **å·²å®ç°**ï¼š
- ä¸‰ç§éªŒè¯ç ç±»å‹é…ç½®
- çµæ´»çš„å¼€å…³æ§åˆ¶
- åˆç†çš„é»˜è®¤å€¼
- æ¸…æ™°çš„é”™è¯¯æç¤º

ğŸ“ **é…ç½®åŸåˆ™**ï¼š
- å¼€å‘ç¯å¢ƒï¼šæ–¹ä¾¿æµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒï¼šå®‰å…¨ç¬¬ä¸€
- æµ‹è¯•ç¯å¢ƒï¼šæŒ‰éœ€é…ç½®

ğŸ”’ **å®‰å…¨æç¤º**ï¼š
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å¼€å¯æ‰€æœ‰éªŒè¯ç 
- å®šæœŸç›‘æ§éªŒè¯ç ä½¿ç”¨æƒ…å†µ
- é˜²æ­¢éªŒè¯ç è¢«æ¶æ„åˆ·å–
