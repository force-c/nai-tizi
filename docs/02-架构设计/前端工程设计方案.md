# 前端工程设计方案

## 项目概述

**项目名称：** NAI-TIZI 管理后台  
**技术栈：** Vue 3 + TypeScript + Vben5 + Ant Design Vue  
**目标：** 构建现代化、高性能的企业级管理后台系统

---

## 技术选型

### 核心框架

| 技术 | 版本 | 说明 |
|------|------|------|
| Vue | 3.4+ | 渐进式 JavaScript 框架 |
| TypeScript | 5.0+ | JavaScript 的超集，提供类型安全 |
| Vite | 5.0+ | 下一代前端构建工具 |
| Vben Admin | 5.x | 基于 Vue 3 的企业级中后台解决方案 |
| Ant Design Vue | 4.x | 企业级 UI 组件库 |

### 状态管理

- **Pinia** - Vue 3 官方推荐的状态管理库
- **Pinia Persist** - 状态持久化插件

### 路由管理

- **Vue Router** 4.x - Vue 官方路由管理器
- 支持动态路由、路由守卫、权限控制

### HTTP 请求

- **Axios** - Promise 基于的 HTTP 客户端
- 请求/响应拦截器
- 统一错误处理

### 工具库

| 工具 | 说明 |
|------|------|
| VueUse | Vue 组合式 API 工具集 |
| Day.js | 轻量级日期处理库 |
| Lodash-es | JavaScript 实用工具库 |
| NProgress | 页面加载进度条 |

### 代码规范

| 工具 | 说明 |
|------|------|
| ESLint | JavaScript/TypeScript 代码检查 |
| Prettier | 代码格式化 |
| Stylelint | CSS/SCSS 代码检查 |
| Husky | Git hooks 工具 |
| Commitlint | Git commit 信息规范检查 |

---

## 项目结构

```
web/
├── .husky/                 # Git hooks 配置
├── .vscode/               # VSCode 配置
├── public/                # 静态资源
│   ├── favicon.ico
│   └── logo.png
├── src/
│   ├── api/              # API 接口定义
│   │   ├── auth/         # 认证相关接口
│   │   ├── user/         # 用户管理接口
│   │   ├── role/         # 角色管理接口
│   │   ├── storage/      # 存储管理接口
│   │   └── attachment/   # 附件管理接口
│   ├── assets/           # 资源文件
│   │   ├── images/       # 图片
│   │   ├── icons/        # 图标
│   │   └── styles/       # 全局样式
│   ├── components/       # 公共组件
│   │   ├── Basic/        # 基础组件
│   │   ├── Form/         # 表单组件
│   │   ├── Table/        # 表格组件
│   │   └── Upload/       # 上传组件
│   ├── composables/      # 组合式函数
│   │   ├── useAuth.ts    # 认证相关
│   │   ├── useTable.ts   # 表格相关
│   │   └── useForm.ts    # 表单相关
│   ├── layouts/          # 布局组件
│   │   ├── default/      # 默认布局
│   │   └── blank/        # 空白布局
│   ├── router/           # 路由配置
│   │   ├── index.ts      # 路由入口
│   │   ├── routes/       # 路由定义
│   │   └── guards/       # 路由守卫
│   ├── stores/           # 状态管理
│   │   ├── auth.ts       # 认证状态
│   │   ├── user.ts       # 用户状态
│   │   ├── app.ts        # 应用状态
│   │   └── permission.ts # 权限状态
│   ├── types/            # TypeScript 类型定义
│   │   ├── api.d.ts      # API 类型
│   │   ├── store.d.ts    # Store 类型
│   │   └── global.d.ts   # 全局类型
│   ├── utils/            # 工具函数
│   │   ├── request.ts    # HTTP 请求封装
│   │   ├── auth.ts       # 认证工具
│   │   ├── storage.ts    # 本地存储
│   │   └── validate.ts   # 表单验证
│   ├── views/            # 页面组件
│   │   ├── auth/         # 认证页面
│   │   │   ├── login/    # 登录
│   │   │   └── register/ # 注册
│   │   ├── dashboard/    # 仪表盘
│   │   ├── system/       # 系统管理
│   │   │   ├── user/     # 用户管理
│   │   │   ├── role/     # 角色管理
│   │   │   └── menu/     # 菜单管理
│   │   ├── storage/      # 存储管理
│   │   │   ├── env/      # 存储环境
│   │   │   └── file/     # 文件管理
│   │   └── error/        # 错误页面
│   │       ├── 403.vue
│   │       ├── 404.vue
│   │       └── 500.vue
│   ├── App.vue           # 根组件
│   └── main.ts           # 入口文件
├── .env                  # 环境变量
├── .env.development      # 开发环境变量
├── .env.production       # 生产环境变量
├── .eslintrc.js          # ESLint 配置
├── .prettierrc.js        # Prettier 配置
├── index.html            # HTML 模板
├── package.json          # 项目依赖
├── tsconfig.json         # TypeScript 配置
├── vite.config.ts        # Vite 配置
└── README.md             # 项目说明
```

---

## 核心功能模块

### 1. 认证模块

#### 功能清单

- **登录**
  - 密码登录
  - 邮箱验证码登录
  - 微信小程序登录
  - 记住密码
  - 图形验证码

- **登出**
  - 清除本地 Token
  - 清除用户信息
  - 跳转登录页

- **Token 管理**
  - AccessToken 自动刷新
  - RefreshToken 轮换
  - Token 过期处理

#### 技术实现

```typescript
// stores/auth.ts
export const useAuthStore = defineStore('auth', {
  state: () => ({
    accessToken: '',
    refreshToken: '',
    userInfo: null,
    isLoggedIn: false,
  }),
  
  actions: {
    async login(credentials) {
      // 登录逻辑
    },
    
    async logout() {
      // 登出逻辑
    },
    
    async refreshToken() {
      // 刷新 Token
    },
  },
  
  persist: true, // 持久化
});
```

### 2. 用户管理模块

#### 功能清单

- 用户列表（分页、搜索、筛选）
- 新增用户
- 编辑用户
- 删除用户
- 批量删除
- 重置密码
- 用户详情
- 用户角色分配

#### 页面组件

```
views/system/user/
├── index.vue           # 用户列表页
├── components/
│   ├── UserTable.vue   # 用户表格
│   ├── UserForm.vue    # 用户表单
│   └── UserDetail.vue  # 用户详情
└── types.ts            # 类型定义
```

### 3. 角色管理模块

#### 功能清单

- 角色列表
- 新增角色
- 编辑角色
- 删除角色
- 角色权限配置
- 角色继承设置
- 用户角色分配

#### 权限控制

```typescript
// 指令方式
<a-button v-permission="'role.create'">新增角色</a-button>

// 函数方式
import { usePermission } from '@/composables/usePermission';

const { hasPermission } = usePermission();

if (hasPermission('role.delete')) {
  // 执行删除操作
}
```

### 4. 存储管理模块

#### 功能清单

**存储环境管理**
- 环境列表
- 新增环境
- 编辑环境
- 删除环境
- 设置默认环境
- 环境配置（Local/S3）

**文件管理**
- 文件上传（分两步）
- 文件列表
- 文件预览
- 文件下载
- 文件删除
- 业务绑定

#### 上传组件

```vue
<!-- components/Upload/AttachmentUpload.vue -->
<template>
  <div class="attachment-upload">
    <!-- 步骤1：上传文件 -->
    <a-upload
      :before-upload="handleBeforeUpload"
      :custom-request="handleUpload"
    >
      <a-button>
        <upload-outlined />
        选择文件
      </a-button>
    </a-upload>
    
    <!-- 步骤2：绑定业务信息 -->
    <a-modal v-model:visible="bindModalVisible">
      <a-form :model="bindForm">
        <a-form-item label="业务类型">
          <a-input v-model:value="bindForm.businessType" />
        </a-form-item>
        <!-- 其他字段 -->
      </a-form>
    </a-modal>
  </div>
</template>
```

### 5. 仪表盘模块

#### 功能清单

- 数据统计卡片
- 用户增长趋势图
- 存储使用情况
- 最近操作日志
- 快捷入口

---

## API 接口设计

### 接口封装

```typescript
// utils/request.ts
import axios from 'axios';
import { useAuthStore } from '@/stores/auth';

const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000,
});

// 请求拦截器
request.interceptors.request.use(
  (config) => {
    const authStore = useAuthStore();
    if (authStore.accessToken) {
      config.headers.Authorization = `Bearer ${authStore.accessToken}`;
    }
    return config;
  },
  (error) => Promise.reject(error),
);

// 响应拦截器
request.interceptors.response.use(
  (response) => {
    const { code, data, message } = response.data;
    
    if (code === 200) {
      return data;
    }
    
    // 处理错误
    if (code === 401) {
      // Token 过期，尝试刷新
      return refreshTokenAndRetry(response.config);
    }
    
    return Promise.reject(new Error(message));
  },
  (error) => {
    // 统一错误处理
    return Promise.reject(error);
  },
);

export default request;
```

### API 模块示例

```typescript
// api/auth/index.ts
import request from '@/utils/request';

export interface LoginParams {
  grantType: 'password' | 'email' | 'xcx';
  username?: string;
  password?: string;
  email?: string;
  code?: string;
  clientKey: string;
  clientSecret: string;
}

export interface LoginResponse {
  accessToken: string;
  refreshToken: string;
  expiresIn: number;
  refreshExpiresIn: number;
  userInfo: UserInfo;
}

export const authApi = {
  // 登录
  login: (params: LoginParams) => 
    request.post<LoginResponse>('/login', params),
  
  // 登出
  logout: () => 
    request.post('/logout'),
  
  // 刷新 Token
  refreshToken: (params: { refreshToken: string; clientKey: string; clientSecret: string }) =>
    request.post('/auth/refresh', params),
  
  // 获取当前用户信息
  me: () =>
    request.get('/me'),
};
```

---

## 状态管理设计

### Auth Store

```typescript
// stores/auth.ts
import { defineStore } from 'pinia';
import { authApi } from '@/api/auth';

export const useAuthStore = defineStore('auth', {
  state: () => ({
    accessToken: '',
    refreshToken: '',
    userInfo: null as UserInfo | null,
    isLoggedIn: false,
  }),
  
  getters: {
    userId: (state) => state.userInfo?.userId,
    username: (state) => state.userInfo?.username,
  },
  
  actions: {
    async login(credentials: LoginParams) {
      try {
        const res = await authApi.login(credentials);
        this.accessToken = res.accessToken;
        this.refreshToken = res.refreshToken;
        this.userInfo = res.userInfo;
        this.isLoggedIn = true;
        return res;
      } catch (error) {
        throw error;
      }
    },
    
    async logout() {
      try {
        await authApi.logout();
      } finally {
        this.accessToken = '';
        this.refreshToken = '';
        this.userInfo = null;
        this.isLoggedIn = false;
      }
    },
    
    async refreshAccessToken() {
      const res = await authApi.refreshToken({
        refreshToken: this.refreshToken,
        clientKey: import.meta.env.VITE_CLIENT_KEY,
        clientSecret: import.meta.env.VITE_CLIENT_SECRET,
      });
      this.accessToken = res.accessToken;
      this.refreshToken = res.refreshToken;
    },
  },
  
  persist: {
    key: 'auth',
    storage: localStorage,
    paths: ['accessToken', 'refreshToken', 'userInfo'],
  },
});
```

### Permission Store

```typescript
// stores/permission.ts
import { defineStore } from 'pinia';

export const usePermissionStore = defineStore('permission', {
  state: () => ({
    permissions: [] as string[],
    roles: [] as string[],
  }),
  
  getters: {
    hasPermission: (state) => (permission: string) => {
      return state.permissions.includes(permission) || 
             state.permissions.includes('*');
    },
    
    hasRole: (state) => (role: string) => {
      return state.roles.includes(role);
    },
  },
  
  actions: {
    async fetchPermissions() {
      // 获取用户权限
    },
  },
});
```

---

## 路由设计

### 路由配置

```typescript
// router/routes/index.ts
import type { RouteRecordRaw } from 'vue-router';

export const routes: RouteRecordRaw[] = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/auth/login/index.vue'),
    meta: {
      title: '登录',
      requiresAuth: false,
    },
  },
  {
    path: '/',
    name: 'Layout',
    component: () => import('@/layouts/default/index.vue'),
    redirect: '/dashboard',
    meta: {
      requiresAuth: true,
    },
    children: [
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('@/views/dashboard/index.vue'),
        meta: {
          title: '仪表盘',
          icon: 'dashboard',
        },
      },
      {
        path: 'system',
        name: 'System',
        meta: {
          title: '系统管理',
          icon: 'setting',
        },
        children: [
          {
            path: 'user',
            name: 'SystemUser',
            component: () => import('@/views/system/user/index.vue'),
            meta: {
              title: '用户管理',
              permission: 'user.read',
            },
          },
          {
            path: 'role',
            name: 'SystemRole',
            component: () => import('@/views/system/role/index.vue'),
            meta: {
              title: '角色管理',
              permission: 'role.read',
            },
          },
        ],
      },
      {
        path: 'storage',
        name: 'Storage',
        meta: {
          title: '存储管理',
          icon: 'cloud',
        },
        children: [
          {
            path: 'env',
            name: 'StorageEnv',
            component: () => import('@/views/storage/env/index.vue'),
            meta: {
              title: '存储环境',
              permission: 'storage.read',
            },
          },
          {
            path: 'file',
            name: 'StorageFile',
            component: () => import('@/views/storage/file/index.vue'),
            meta: {
              title: '文件管理',
              permission: 'attachment.read',
            },
          },
        ],
      },
    ],
  },
  {
    path: '/:pathMatch(.*)*',
    name: 'NotFound',
    component: () => import('@/views/error/404.vue'),
  },
];
```

### 路由守卫

```typescript
// router/guards/auth.ts
import type { Router } from 'vue-router';
import { useAuthStore } from '@/stores/auth';

export function setupAuthGuard(router: Router) {
  router.beforeEach(async (to, from, next) => {
    const authStore = useAuthStore();
    
    // 不需要认证的页面
    if (!to.meta.requiresAuth) {
      return next();
    }
    
    // 检查是否登录
    if (!authStore.isLoggedIn) {
      return next({
        name: 'Login',
        query: { redirect: to.fullPath },
      });
    }
    
    // 检查权限
    if (to.meta.permission) {
      const permissionStore = usePermissionStore();
      if (!permissionStore.hasPermission(to.meta.permission as string)) {
        return next({ name: 'Forbidden' });
      }
    }
    
    next();
  });
}
```

---

## UI 组件规范

### 表格组件

```vue
<!-- components/Table/BasicTable.vue -->
<template>
  <div class="basic-table">
    <div class="table-toolbar">
      <a-space>
        <slot name="toolbar-left"></slot>
      </a-space>
      <a-space>
        <slot name="toolbar-right"></slot>
        <a-button @click="handleRefresh">
          <reload-outlined />
        </a-button>
      </a-space>
    </div>
    
    <a-table
      :columns="columns"
      :data-source="dataSource"
      :loading="loading"
      :pagination="pagination"
      @change="handleTableChange"
    >
      <template #bodyCell="{ column, record }">
        <slot :name="`cell-${column.dataIndex}`" :record="record">
          {{ record[column.dataIndex] }}
        </slot>
      </template>
    </a-table>
  </div>
</template>
```

### 表单组件

```vue
<!-- components/Form/BasicForm.vue -->
<template>
  <a-form
    :model="formData"
    :rules="rules"
    :label-col="labelCol"
    :wrapper-col="wrapperCol"
  >
    <slot></slot>
    
    <a-form-item :wrapper-col="{ offset: labelCol.span }">
      <a-space>
        <a-button type="primary" @click="handleSubmit">
          提交
        </a-button>
        <a-button @click="handleReset">
          重置
        </a-button>
      </a-space>
    </a-form-item>
  </a-form>
</template>
```

---

## 开发规范

### 命名规范

- **文件命名：** kebab-case（user-list.vue）
- **组件命名：** PascalCase（UserList）
- **变量命名：** camelCase（userName）
- **常量命名：** UPPER_SNAKE_CASE（API_BASE_URL）
- **类型命名：** PascalCase（UserInfo）

### 代码规范

- 使用 Composition API
- 使用 `<script setup>` 语法
- 使用 TypeScript 类型注解
- 遵循 ESLint 规则
- 使用 Prettier 格式化

### Git 提交规范

```
feat: 新功能
fix: 修复 bug
docs: 文档更新
style: 代码格式调整
refactor: 重构
perf: 性能优化
test: 测试相关
chore: 构建/工具相关
```

---

## 性能优化

### 1. 路由懒加载

```typescript
component: () => import('@/views/user/index.vue')
```

### 2. 组件懒加载

```typescript
const UserForm = defineAsyncComponent(() => 
  import('./components/UserForm.vue')
);
```

### 3. 图片懒加载

```vue
<img v-lazy="imageUrl" />
```

### 4. 虚拟滚动

```vue
<a-table :virtual="true" :scroll="{ y: 500 }" />
```

### 5. 请求防抖/节流

```typescript
import { useDebounceFn } from '@vueuse/core';

const handleSearch = useDebounceFn((value) => {
  // 搜索逻辑
}, 300);
```

---

## 部署方案

### 开发环境

```bash
npm run dev
```

### 生产构建

```bash
npm run build
```

### Docker 部署

```dockerfile
FROM node:18-alpine as builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

---

## 相关文档

- [Vben Admin 文档](https://doc.vben.pro/)
- [Ant Design Vue 文档](https://antdv.com/)
- [Vue 3 文档](https://cn.vuejs.org/)
- [TypeScript 文档](https://www.typescriptlang.org/)

---

**设计时间：** 2024-12-20  
**设计人员：** Kiro AI Assistant  
**版本：** v1.0.0
